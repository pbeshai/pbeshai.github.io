<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-blog-post-js.1d3c152f5f561507ccdb.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:.92em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:16px 0 32px;overflow:auto;border-bottom:2px solid #f1f3f5;background:#fbfbfc;border-radius:4px}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.0.59"/><title data-react-helmet="true">Animating points on maps with deck.gl - Peter Beshai</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:700|Karla:400,400i,700" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Learn how to animate points on maps using Uber&#x27;s deck.gl library with the built-in transition support and custom shaders."/><meta data-react-helmet="true" name="twitter:description" content="Learn how to animate points on maps using Uber&#x27;s deck.gl library with the built-in transition support and custom shaders."/><meta data-react-helmet="true" property="og:description" content="Learn how to animate points on maps using Uber&#x27;s deck.gl library with the built-in transition support and custom shaders."/><meta data-react-helmet="true" name="keywords" content="data vis, visualization, creative coding, generative art, nba, basketball"/><meta data-react-helmet="true" name="twitter:site" content="@pbesh"/><meta data-react-helmet="true" name="twitter:creator" content="@pbesh"/><meta data-react-helmet="true" property="og:title" content="Animating points on maps with deck.gl"/><meta data-react-helmet="true" property="twitter:title" content="Animating points on maps with deck.gl"/><meta data-react-helmet="true" property="og:url" content="https://peterbeshai.com/blog/2019-08-10-deckgl-point-animation/"/><meta data-react-helmet="true" property="og:image" content="https://peterbeshai.com/static/d5256590c6affd3f1a081b84e24838a0/89b45/preview.png"/><meta data-react-helmet="true" name="twitter:image" content="https://peterbeshai.com/static/d5256590c6affd3f1a081b84e24838a0/89b45/preview.png"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#000000"/><style data-styled="iDyhdk efFTfJ hhyHDk gTlRLk jsxnmT jeewNL hhXpxd jrfCIt dJCJrh ecGEQi ijWubC euoGcv cnqcGN jnpqTa dFzgml bQkNVd" data-styled-version="4.1.1">
/* sc-component-id: sc-bdVaJa */
.iDyhdk{margin-left:auto;margin-right:auto;padding:16px;max-width:800px;}.efFTfJ{margin-bottom:16px;}.hhyHDk{margin-top:128px;}.gTlRLk{margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:64px;padding-bottom:64px;}
/* sc-component-id: sc-htpNat */
.jsxnmT{text-align:center;}.jeewNL{margin-bottom:32px;margin-top:16px;}
/* sc-component-id: sc-bxivhb */
.hhXpxd{margin:0px;font-size:23px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:uppercase;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.jrfCIt{margin:0px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:uppercase;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.dJCJrh{margin:0px;margin-bottom:16px;margin-top:64px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:none;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.ecGEQi{margin:0px;margin-bottom:16px;margin-top:64px;font-size:23px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:none;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}
/* sc-component-id: sc-ifAKCX */
.jnpqTa{color:#495057;border-bottom:2px solid #e9ecef;-webkit-text-decoration:none;text-decoration:none;background:transparent;-webkit-transition:0.2s background linear,0.2s border-color linear;transition:0.2s background linear,0.2s border-color linear;} .jnpqTa:hover{color:#343a40;background:#e3fafc;border-color:#99e9f2;}
/* sc-component-id: sc-bZQynM */
.bQkNVd{margin:0px;margin-left:auto;margin-right:auto;display:block;max-width:100%;height:auto;}
/* sc-component-id: core__List-eqpeba-0 */
.dFzgml{margin-bottom:32px;margin-top:0px;}
/* sc-component-id: core__InlineList-eqpeba-1 */
.ijWubC{list-style-type:none;padding-left:0;}.euoGcv{color:#868e96;list-style-type:none;list-style-type:none;padding-left:0;}
/* sc-component-id: core__InlineListItem-eqpeba-2 */
.cnqcGN{margin-right:16px;display:inline-block;} .cnqcGN:last-child{margin-right:0;} .cnqcGN::before{content:'â€¢';color:#dee2e6;margin-right:16px;} .cnqcGN:first-child::before{content:'';margin-right:0;}
/* sc-component-id: sc-global-1926057577 */
html,body,#___gatsby{background-color:#fff;width:100%;height:100%;padding:0;margin:0;color:#000;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:Karla,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;line-height:1.7;font-size:19px;} *{box-sizing:border-box;} #___gatsby > div{height:100%;} img.full-width-image{width:100%;} a{color:#495057;}</style><link as="script" rel="preload" href="/component---src-templates-blog-post-js-e86b92af2fef775e9216.js"/><link as="script" rel="preload" href="/app-b6ef64a05ca2a06bac27.js"/><link as="script" rel="preload" href="/1-be46941191aa236417e9.js"/><link as="script" rel="preload" href="/0-d7ef72559a49db3dc3fb.js"/><link as="script" rel="preload" href="/webpack-runtime-b695b7f64e76f2dea35c.js"/><link rel="preload" href="/static/d/854/path---blog-2019-08-10-deckgl-point-animation-0-c-1-2db-JZn1FbHj3Mai2rh63OLUTNaK1k.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><div class="sc-bdVaJa iDyhdk"><div class="sc-htpNat jsxnmT"><h2 font-size="3" font-weight="bold" font-family="header" class="sc-bxivhb hhXpxd">Peter Beshai</h2><ul class="core__InlineList-eqpeba-1 ijWubC"><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a class="sc-ifAKCX jnpqTa" href="/">Home</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a class="sc-ifAKCX jnpqTa" href="/#writing">Writing</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a class="sc-ifAKCX jnpqTa" href="/#projects">Projects</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a class="sc-ifAKCX jnpqTa" href="/#experiments">Experiments</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a class="sc-ifAKCX jnpqTa" href="/#open-source">Open Source</a></li></ul></div></div><div class="sc-bdVaJa iDyhdk"><h2 font-size="4" font-weight="bold" font-family="header" class="sc-bxivhb jrfCIt">Animating points on maps with deck.gl</h2><ul color="gray.6" class="core__InlineList-eqpeba-1 euoGcv"><li class="core__InlineListItem-eqpeba-2 cnqcGN">August 10, 2019</li><li class="core__InlineListItem-eqpeba-2 cnqcGN">5 min read</li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a class="sc-ifAKCX jnpqTa" href="/deckgl-point-animation/">Demo</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a href="https://github.com/pbeshai/deckgl-point-animation" class="sc-ifAKCX jnpqTa">GitHub</a></li></ul><div><div class="sc-htpNat jeewNL">You&#x27;d think I&#x27;d be tired of <a href="https://peterbeshai.com/blog/2017-05-26-beautifully-animate-points-with-webgl-and-regl/" class="sc-ifAKCX jnpqTa">animating points</a> <a href="https://bocoup.com/blog/smoothly-animate-thousands-of-points-with-html5-canvas-and-d3" class="sc-ifAKCX jnpqTa">by now</a>, but it hasn&#x27;t gotten old for me yet. I recently had the opportunity at <a href="https://cortico.ai" class="sc-ifAKCX jnpqTa">work</a> to build some map-based animations for a video we were putting together and the first thing that came to mind was to use the excellent <a href="https://deck.gl" class="sc-ifAKCX jnpqTa">deck.gl</a> library from the <a href="https://vis.gl/" class="sc-ifAKCX jnpqTa">Uber data vis team</a>.</div>
<div class="sc-htpNat jeewNL">I wanted to have a glitzy reveal of all 17,000+ public libraries in the US and ended up with the following:</div>
<div class="sc-htpNat jeewNL">
          </div><div class="gatsby-resp-iframe-wrapper" style="padding-bottom:56.42857142857143%;position:relative;height:0;overflow:hidden">
            <div class="embedVideo-container">
            <iframe src="https://www.youtube.com/embed/e6eIWZVFr4o?rel=0" class="embedVideo-iframe" style="border:0;position:absolute;top:0;left:0;width:100%;height:100%" allowfullscreen=""></iframe>
        </div>
          </div>
          <div class="sc-htpNat jeewNL"></div>
<div class="sc-htpNat jeewNL">This post will cover how to make something like that yourself.</div>
<ul class="core__List-eqpeba-0 dFzgml">
<li class="sc-bdVaJa efFTfJ"><a href="/deckgl-point-animation/" class="sc-ifAKCX jnpqTa">Demo</a></li>
<li class="sc-bdVaJa efFTfJ"><a href="https://github.com/pbeshai/deckgl-point-animation" class="sc-ifAKCX jnpqTa">Source Code on GitHub</a></li>
</ul>
<h2 font-size="4" font-weight="bold" font-family="header" class="sc-bxivhb dJCJrh">Basic point animation using transitions with ScatterplotLayer</h2>
<div class="sc-htpNat jeewNL">If you haven&#x27;t used deck.gl before, check out <a href="https://deck.gl/#/documentation/getting-started/using-standalone" class="sc-ifAKCX jnpqTa">the examples in their documentation</a> or view <a href="https://github.com/pbeshai/deckgl-point-animation" class="sc-ifAKCX jnpqTa">the code for this demo</a> for details on how to get started.</div>
<div class="sc-htpNat jeewNL">The first approach we&#x27;ll try for bringing animation to our map vis is to leverage the built-in support for <a href="https://deck.gl/#/documentation/deckgl-api-reference/layers/layer?section=transitions-object-optional-" class="sc-ifAKCX jnpqTa"><code class="language-text">transitions</code></a>. Consider a basic <a href="https://deck.gl/#/documentation/deckgl-api-reference/layers/scatterplot-layer" class="sc-ifAKCX jnpqTa"><code class="language-text">ScatterplotLayer</code></a>:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> librariesLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScatterplotLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">&#x27;points-layer&#x27;</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> librariesData<span class="token punctuation">,</span>
  getPosition<span class="token punctuation">:</span> d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token comment">// [longitude, latitude] tuple</span>
  getFillColor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  getRadius<span class="token punctuation">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="sc-htpNat jeewNL">This will render our libraries as a bunch of points colored <span style="color:rgb(60, 220, 255)">rgb(60, 220, 255)</span>, as shown below.</div>
<div class="sc-htpNat jeewNL"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;max-width:700px;margin-left:auto;margin-right:auto">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:56.29397967161845%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACO0lEQVQoz1WT3VLaUBSFeQgJSQgoFgJEICHJOSH8tKggiOhYHR0daTu2Tm/a6/YBetHHXl37RC96sZKQM3x77b12Su8OD5HmY6gsQ6o10jT5Xyo1iuMhkmGEIOgaKTlLYiQxxXs8HKJ3FKDkODaS0zPo41Oks/cGqrI3cFoUYTE1mSKZzNDtD9D02+j3e4iiEIqFUioOB9B5jpLreYjGU6jRiE5zKAEYqVfxmWd6tcHo5h7p2TmCfIpOqhG0fSTjMfTmEnr3gm5GYLVeR0KQ2C/+nBuwcSfORPMTqLsn6Psd0s/fET4+IyEgOtsgub7D6NcfDH7/hVWpFA5jzlBcmJkoumJVRag+WZjnbH0BffkRii6zhy/Idt+gv/6AYoHs0wv6zz/h1PfhOA5KdsVCuLrAiK2kHLpxxFbVZGLmJo71YgV1dQO1XEFvCd5cQW2voc+3ULePqDVbqJT34LhVAm0btYMGkuU59Id54VRmJ21L8vyt+F5gShyvtwWMI8joMGIx6dJ2XQJdpsxLxSqjHvSY9hIZnZlWpfVXoF6u6YaDZxcZXWUEjm4fMGDqLlsVU8KxpWXnlVyxLDQO9s2OCUx2y+wgw1EspAiMFmv05gv4gxDhbI5mFMMql+FWq3jjlCQZIYtlOWi1mmZBZXET2TEJajpDoxsUTqoeIXvwmj6OjpcmWYs5FHem3Gy14NVqBZSq79fRaDQw4OIKNOeSDwm2+QFIil7NI7Rq4J1oiH4YotPtwm+30fJ9/AMamlzAXZN95QAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
    <img display="block" class="gatsby-resp-image-image sc-bZQynM bQkNVd" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px #fff" alt="ScatterplotLayer Libraries" title="" src="/static/f98e4f9161723910129f460a7feead4f/94d90/scatterplotlayer1.png" srcSet="/static/f98e4f9161723910129f460a7feead4f/28a98/scatterplotlayer1.png 175w, /static/f98e4f9161723910129f460a7feead4f/1fbec/scatterplotlayer1.png 350w, /static/f98e4f9161723910129f460a7feead4f/94d90/scatterplotlayer1.png 700w, /static/f98e4f9161723910129f460a7feead4f/93aea/scatterplotlayer1.png 1050w, /static/f98e4f9161723910129f460a7feead4f/b952e/scatterplotlayer1.png 1279w" sizes="(max-width: 700px) 100vw, 700px"/>
  </span></div>
<div class="sc-htpNat jeewNL">Now if we want to animate the colors of the points, we can modify our layer props to include <code class="language-text">transitions</code> with <code class="language-text">getFillColor</code> specified:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> showLibraries <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> librariesLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScatterplotLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">&#x27;points-layer&#x27;</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> librariesData<span class="token punctuation">,</span>
  getPosition<span class="token punctuation">:</span> d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
  getFillColor<span class="token punctuation">:</span> showLibraries <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  getRadius<span class="token punctuation">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  transitions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// transition with a duration of 3000ms</span>
    getFillColor<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="sc-htpNat jeewNL">When we set <code class="language-text">showLibraries = true</code> and update deck.gl&#x27;s layers, we&#x27;ll get the following animation:</div>
<div class="sc-htpNat jeewNL">
          </div><div class="gatsby-resp-iframe-wrapper" style="padding-bottom:56.42857142857143%;position:relative;height:0;overflow:hidden">
            <div class="embedVideo-container">
            <iframe src="https://www.youtube.com/embed/jCPY7PCuyio?rel=0" class="embedVideo-iframe" style="border:0;position:absolute;top:0;left:0;width:100%;height:100%" allowfullscreen=""></iframe>
        </div>
          </div>
          <div class="sc-htpNat jeewNL"></div>
<div class="sc-htpNat jeewNL">We&#x27;re using the transitions shorthand here, which says when the <code class="language-text">getFillColor</code> value changes we should transition to the new value over 3000ms.</div>
<div class="sc-htpNat jeewNL"><em>Note:</em> If you&#x27;re using a function to specify <code class="language-text">getFillColor</code>, you may also need to provide a value for <code class="language-text">updateTriggers</code> so deck.gl knows it needs to recompute the colors of each point:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> librariesLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScatterplotLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  updateTriggers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// if showLibraries changes, recompute getFillColor for each point</span>
    getFillColor<span class="token punctuation">:</span> <span class="token punctuation">[</span>showLibraries<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="sc-htpNat jeewNL">If we want the points to grow into place in addition to the color tween, we can animate the radius by specifying <code class="language-text">getRadius</code> in the <code class="language-text">transitions</code> object.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> librariesLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScatterplotLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">&#x27;points-layer&#x27;</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> librariesData<span class="token punctuation">,</span>
    getPosition<span class="token punctuation">:</span> d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
    getFillColor<span class="token punctuation">:</span> showLibraries <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    getRadius<span class="token punctuation">:</span> showLibraries <span class="token operator">?</span> <span class="token number">5000</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    transitions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      getFillColor<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      getRadius<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        duration<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
        easing<span class="token punctuation">:</span> d3<span class="token punctuation">.</span>easeBackInOut<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="sc-htpNat jeewNL">This time we used the expanded transitions definition which allows us to set an <a href="https://easings.net" class="sc-ifAKCX jnpqTa">easing</a> for the animation to follow. The effect is shown below:</div>
<div class="sc-htpNat jeewNL">
          </div><div class="gatsby-resp-iframe-wrapper" style="padding-bottom:56.42857142857143%;position:relative;height:0;overflow:hidden">
            <div class="embedVideo-container">
            <iframe src="https://www.youtube.com/embed/6uIMUvjT4zg?rel=0" class="embedVideo-iframe" style="border:0;position:absolute;top:0;left:0;width:100%;height:100%" allowfullscreen=""></iframe>
        </div>
          </div>
          <div class="sc-htpNat jeewNL"></div>
<div class="sc-htpNat jeewNL">That was pretty easy! Thanks deck.gl, you&#x27;re the best. The effect is more noticeable with a bigger radius or higher resolution, but you get the idea.</div>
<div class="sc-htpNat jeewNL">That was cool and all, however often times things look even cooler if we can add a little delay to each point instead of having them all animate in at once. To solve that, we have to do something a bit more complex and use a custom layer.</div>
<h2 font-size="4" font-weight="bold" font-family="header" class="sc-bxivhb dJCJrh">Add in point delay with a custom layer</h2>
<div class="sc-htpNat jeewNL">I&#x27;ve created a layer I call the <a href="https://github.com/pbeshai/deckgl-point-animation/blob/master/src/DelayedPointLayer.js" class="sc-ifAKCX jnpqTa"><code class="language-text">DelayPointLayer</code></a> that allows you to render in points with delay specified by a function, similar to how <a href="https://github.com/d3/d3-transition" class="sc-ifAKCX jnpqTa">d3 transitions</a> work. I won&#x27;t cover the internals of how it works here, but please feel free to view <a href="https://github.com/pbeshai/deckgl-point-animation/blob/master/src/DelayedPointLayer.js" class="sc-ifAKCX jnpqTa">the source code</a> and tune it to your needs.</div>
<div class="sc-htpNat jeewNL">The <code class="language-text">DelayPointLayer</code> requires specifying three new properties on your point layer:</div>
<ul class="core__List-eqpeba-0 dFzgml">
<li class="sc-bdVaJa efFTfJ"><strong>animationProgress</strong> How far through the animation you currently are (a value between 0 and 1). At 0, the animation has not started. At 1, all points are done animating.</li>
<li class="sc-bdVaJa efFTfJ"><strong>pointDuration</strong> How long a single point takes to animate as a proportion of the animation progress (a value between 0 and 1). A value of 0.25 means any given point will take 25% of the animation duration to completely animate (works best with linear easing on <code class="language-text">animationProgress</code>). The final point begins animating when <code class="language-text">animationProgress</code> is at <code class="language-text">1 - pointDuration</code>.</li>
<li class="sc-bdVaJa efFTfJ"><strong>getDelayFactor</strong> A function mapping from a data point to a value between 0 and 1 representing when this point should begin animating. A value of 0 means it will begin animating immediately and 1 means it will be the last point to animate.</li>
</ul>
<div class="sc-htpNat jeewNL">Let&#x27;s look at our library example:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// value between 0 and 1 representing animation progress</span>
<span class="token keyword">const</span> librariesAnimation <span class="token operator">=</span> <span class="token punctuation">{</span> enterProgress<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// create a scale that maps longitudinal values to values between 0 and 1</span>
<span class="token comment">// based on the min and max longitudes in the dataset.</span>
<span class="token keyword">const</span> longitudeDelayScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span><span class="token function">extent</span><span class="token punctuation">(</span>librariesData<span class="token punctuation">,</span> d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>position<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> librariesLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DelayedPointLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">&#x27;points-layer&#x27;</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> librariesData<span class="token punctuation">,</span>
  getPosition<span class="token punctuation">:</span> d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
  getFillColor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  getRadius<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  radiusMinPixels<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>

  <span class="token comment">// specify how far we are through the animation (value between 0 and 1)</span>
  animationProgress<span class="token punctuation">:</span> librariesAnimation<span class="token punctuation">.</span>enterProgress<span class="token punctuation">,</span>

  <span class="token comment">// specify how long a point takes to completely animate as a</span>
  <span class="token comment">// proportion of the overall animation progress (value between 0 and 1)</span>
  pointDuration<span class="token punctuation">:</span> <span class="token number">0.25</span><span class="token punctuation">,</span>

  <span class="token comment">// specify the delay factor for each point (value between 0 and 1)</span>
  getDelayFactor<span class="token punctuation">:</span> d <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// the longitude scale means the points will animate in</span>
    <span class="token comment">// from right to left.</span>
    <span class="token function">longitudeDelayScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>position<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="sc-htpNat jeewNL">Now as we update <code class="language-text">enterProgress</code> to new values between 0 and 1 and tell deck.gl to update its layers, we will see our points animate in. A simple way to get <code class="language-text">enterProgress</code> to animate with regular updates is to use <a href="https://animejs.com" class="sc-ifAKCX jnpqTa">anime.js</a>:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> animation <span class="token operator">=</span> <span class="token function">anime</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  duration<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  <span class="token comment">// animate values in this object</span>
  targets<span class="token punctuation">:</span> librariesAnimation<span class="token punctuation">,</span>
  <span class="token comment">// update this property to have value 1</span>
  enterProgress<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// each tick, update the deck.gl layers with new values</span>
    <span class="token comment">// see full source code for details</span>
    <span class="token function">updateDeckLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="sc-htpNat jeewNL">
          </div><div class="gatsby-resp-iframe-wrapper" style="padding-bottom:56.42857142857143%;position:relative;height:0;overflow:hidden">
            <div class="embedVideo-container">
            <iframe src="https://www.youtube.com/embed/32mw1DUmoNU?rel=0" class="embedVideo-iframe" style="border:0;position:absolute;top:0;left:0;width:100%;height:100%" allowfullscreen=""></iframe>
        </div>
          </div>
          <div class="sc-htpNat jeewNL"></div>
<div class="sc-htpNat jeewNL">There&#x27;s plenty of other modifications you can do with the <code class="language-text">DelayPointLayer</code> and I tend to just edit the shader for whatever I am currently looking to do on an ad-hoc basis. I encourage you to do the same! Or even better, make it more robust and release it as a reusable component for everyone to enjoy :)</div>
<h2 font-size="3" font-weight="bold" font-family="header" class="sc-bxivhb ecGEQi">Bonus: make things look fancy with additive blending</h2>
<div class="sc-htpNat jeewNL">Now to really make our points pop, we can dip into the wonderful world of blending. Additive blending is when overlapping colors have their RGB values added together to determine the color that is shown on screen. This results in brighter regions when points are close together and can sometimes feel like a nice glow effect (although typically glows use blurring in addition to this).</div>
<div class="sc-htpNat jeewNL">Luckily, it doesn&#x27;t take much to turn on additive blending in deck.gl, we just provide some parameters to our layer:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token constant">GL</span> <span class="token keyword">from</span> <span class="token string">&#x27;@luma.gl/constants&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> librariesLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DelayedPointLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  parameters<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// prevent flicker from z-fighting</span>
    <span class="token punctuation">[</span><span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// turn on additive blending to make them look more glowy</span>
    <span class="token punctuation">[</span><span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">BLEND_SRC_RGB</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">ONE</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">BLEND_DST_RGB</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">ONE</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">BLEND_EQUATION</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">GL</span><span class="token punctuation">.</span><span class="token constant">FUNC_ADD</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="sc-htpNat jeewNL">
          </div><div class="gatsby-resp-iframe-wrapper" style="padding-bottom:56.42857142857143%;position:relative;height:0;overflow:hidden">
            <div class="embedVideo-container">
            <iframe src="https://www.youtube.com/embed/5HtTSbqxt-Y?rel=0" class="embedVideo-iframe" style="border:0;position:absolute;top:0;left:0;width:100%;height:100%" allowfullscreen=""></iframe>
        </div>
          </div>
          <div class="sc-htpNat jeewNL"></div>
<div class="sc-htpNat jeewNL">Boom, roasted.</div>
<h2 font-size="4" font-weight="bold" font-family="header" class="sc-bxivhb dJCJrh">What&#x27;s next?</h2>
<div class="sc-htpNat jeewNL">After you get your fix animating points, maybe you&#x27;ll move on to animating the <a href="https://deck.gl/#/documentation/deckgl-api-reference/layers/arc-layer" class="sc-ifAKCX jnpqTa"><code class="language-text">ArcLayer</code></a>. <a href="https://github.com/uber/deck.gl/issues/2531#issuecomment-450475596" class="sc-ifAKCX jnpqTa">There&#x27;s a great starting point here</a>. I ended up using something similar to produce the following video:</div>
<div class="sc-htpNat jeewNL">
          </div><div class="gatsby-resp-iframe-wrapper" style="padding-bottom:56.42857142857143%;position:relative;height:0;overflow:hidden">
            <div class="embedVideo-container">
            <iframe src="https://www.youtube.com/embed/6P4XQcnNTAo?rel=0" class="embedVideo-iframe" style="border:0;position:absolute;top:0;left:0;width:100%;height:100%" allowfullscreen=""></iframe>
        </div>
          </div>
          <div class="sc-htpNat jeewNL"></div>
<h2 font-size="4" font-weight="bold" font-family="header" class="sc-bxivhb dJCJrh">Wrapping up</h2>
<div class="sc-htpNat jeewNL">Thanks for reading! Hopefully you now have an idea of how to begin animating with <a href="https://deck.gl" class="sc-ifAKCX jnpqTa">deck.gl</a>. To finish up the videos I made, I saved my animations using <a href="/blog/2018-10-28-p5js-ccapture/" class="sc-ifAKCX jnpqTa">CCapture.js</a> and added some glow to them in After Effects. If you make something after reading this, I&#x27;d love to see itâ€” find me  as <a href="https://twitter.com/pbesh" class="sc-ifAKCX jnpqTa">@pbesh</a> on Twitter.</div>
<ul class="core__List-eqpeba-0 dFzgml">
<li class="sc-bdVaJa efFTfJ"><a href="https://github.com/pbeshai/deckgl-point-animation" class="sc-ifAKCX jnpqTa">Source Code on GitHub</a></li>
<li class="sc-bdVaJa efFTfJ"><a href="/deckgl-point-animation/" class="sc-ifAKCX jnpqTa">Demo</a></li>
</ul>
<div class="sc-htpNat jeewNL">Have a great day!</div></div><div class="sc-bdVaJa hhyHDk"><div id="disqus_thread"></div></div></div><div class="sc-bdVaJa gTlRLk"><div class="sc-htpNat jsxnmT"><ul class="core__InlineList-eqpeba-1 ijWubC"><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a href="mailto:peter.beshai@gmail.com" class="sc-ifAKCX jnpqTa">peter.beshai@gmail.com</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a href="https://twitter.com/pbesh" class="sc-ifAKCX jnpqTa">Twitter</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a href="https://www.linkedin.com/in/pbeshai" class="sc-ifAKCX jnpqTa">LinkedIn</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a href="https://github.com/pbeshai" class="sc-ifAKCX jnpqTa">GitHub</a></li><li class="core__InlineListItem-eqpeba-2 cnqcGN"><a href="https://instagram.com/pbeshasketch" class="sc-ifAKCX jnpqTa">Instagram</a></li></ul></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-55938435-1', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"blog-2019-08-10-deckgl-point-animation-0c1","path":"/blog/2019-08-10-deckgl-point-animation/"};window.dataPath="854/path---blog-2019-08-10-deckgl-point-animation-0-c-1-2db-JZn1FbHj3Mai2rh63OLUTNaK1k";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-b6ef64a05ca2a06bac27.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.1d3c152f5f561507ccdb.css","/component---src-templates-blog-post-js-e86b92af2fef775e9216.js"],"component---src-templates-demo-js":["/component---src-templates-demo-js.1d3c152f5f561507ccdb.css","/component---src-templates-demo-js-b27d21192def89634b14.js"],"component---src-pages-404-js":["/component---src-pages-404-js.1d3c152f5f561507ccdb.css","/component---src-pages-404-js-2dcf30a3796301dfd370.js"],"component---src-pages-index-js":["/component---src-pages-index-js.1d3c152f5f561507ccdb.css","/component---src-pages-index-js-f13e40757851358cd162.js"]};/*]]>*/</script><script src="/webpack-runtime-b695b7f64e76f2dea35c.js" async=""></script><script src="/0-d7ef72559a49db3dc3fb.js" async=""></script><script src="/1-be46941191aa236417e9.js" async=""></script><script src="/app-b6ef64a05ca2a06bac27.js" async=""></script><script src="/component---src-templates-blog-post-js-e86b92af2fef775e9216.js" async=""></script></body></html>